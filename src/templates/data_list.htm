<?php
foreach(@array(
	$CFG["URL"]["base"],
	$CFG["URL"]["ext"],
	$CFG["GENERAL"]["app_name"],
	$items,
	$fields,
	$model_name,
	$form_name,
) as $k=>$var) if ( ! isset($var)) die("Code: ".basename(__FILE__)."-init-".($k+1));

?>
<?php
// ОПЦИИ: значения по умолчанию
// Ширина заголовка страницы: span2 на каждые 10 символов; максимальная ширина span 12
$o["header_span"] = !empty($o["header_span"]) ? $o["header_span"] : min(ceil(mb_strlen($_PAGE["header"], "UTF-8") / 10) * 2, 12);
?>

<article class="app_content">
	<div class="row-fluid">
		<div class="span<?=$o["header_span"];?>">
			<div class="page-header">
				<h1><?=$_PAGE["header"];?></h1>
			</div>
		</div>
		<div class="span<?=12-1-$o["header_span"];?> offset1">

			<?php if(file_exists(cfg_get_filename("templates", "data_list.".$repo_name.".top_actions.htm"))):?>
				<?php include cfg_get_filename("templates", "data_list.".$repo_name.".top_actions.htm");?>
			<?php else:?>
				%%data_list.default.top_actions%%
			<?php endif;?>

		</div>
	</div>

    <?php if (isset($_PAGE["params"]["search"])):?>
        <form action method="get" class="form-search">
            <input type="text" class="input-xxlarge search-query" name="search" value="<?=$search_query;?>" placeholder="<?=$search_placeholder;?>">
            <button type="submit" class="btn">Поиск</button>
        </form>
        <script>
        $("form.form-search").on("submit", function(e){
            window.optimit.app.unsaved = false;
            return true;
        });
        </script>
    <?php endif;?>

	<?php if(empty($items)):?>
		<div class="alert alert-warning">
			Нет данных.
		</div>
	<?php else:?>

		<div class="row-fluid">
			<div class="span12">


      <?php if(file_exists(cfg_get_filename("templates", "data_list.".$repo_name.".table.htm"))):?>
				<?php include cfg_get_filename("templates", "data_list.".$repo_name.".table.htm");?>
			<?php else:?>
        %%pagination%%
				<?php include cfg_get_filename("templates", "data_list.default.table.htm");?>
        %%pagination%%
			<?php endif;?>



			</div>
		</div>
	<?php endif;?>
</article> <!-- /.app_content -->
<script>
$(function(){
	table_sorter( 'table.sortable' );
});
</script>
<?php if (file_exists("assets/app/" . $form_name . ".js")):?>
	<script src="assets/app/<?=$form_name;?>.js"></script>
<?php endif;?>
<?php
	unset($_SESSION["msg"]);
	unset($_SESSION["to"]);
?>
